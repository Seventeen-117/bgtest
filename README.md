# PythonProject æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°

## ğŸš€ å¿«é€Ÿå¼€å§‹

- **[5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹](QUICKSTART.md)** - ç«‹å³ä¸Šæ‰‹
- **[Python 3.8.10 å®‰è£…æŒ‡å—](PYTHON_VERSION_GUIDE.md)** - ç¯å¢ƒé…ç½®
- **[ç¯å¢ƒæ£€æŸ¥](check_environment.py)** - éªŒè¯ç¯å¢ƒ

## ç¯å¢ƒè¦æ±‚

- **Pythonç‰ˆæœ¬**: 3.8.10
- **æ“ä½œç³»ç»Ÿ**: Windows/Linux/macOS
- **å†…å­˜**: å»ºè®®4GBä»¥ä¸Š
- **ç£ç›˜ç©ºé—´**: å»ºè®®1GBä»¥ä¸Šå¯ç”¨ç©ºé—´

## é¡¹ç›®ç®€ä»‹
æœ¬é¡¹ç›®æ˜¯åŸºäº Python + pytest + requests çš„ä¼ä¸šçº§æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°ï¼Œæ”¯æŒå¤šç¯å¢ƒé…ç½®ã€æ•°æ®é©±åŠ¨ã€æ—¥å¿—ä¸æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆï¼Œé€‚ç”¨äºä¼ä¸šæ¥å£æµ‹è¯•å…¨æµç¨‹ã€‚

---

## æµ‹è¯•æµç¨‹æ€»è§ˆ

1. **äº†è§£åˆ†æéœ€æ±‚**ï¼šæ˜ç¡®æ¥å£è¾“å…¥ã€è¾“å‡ºã€‚
2. **æ•°æ®å‡†å¤‡**ï¼šæ•´ç†æ¥å£åŸºæœ¬ä¿¡æ¯ï¼ˆurlã€è¯·æ±‚æ–¹å¼ï¼‰ã€å…¥å‚ã€é¢„æœŸç»“æœã€‚
3. **è®¾è®¡æµ‹è¯•**ï¼šç”Ÿæˆå¯æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ï¼Œè®¾è®¡æ–­è¨€ã€‚
4. **æ‰§è¡Œæµ‹è¯•**ï¼šè¯»å–å‡†å¤‡æ•°æ®è¿›è¡Œå‚æ•°åŒ–ï¼Œè°ƒç”¨æ¥å£å¹¶æ–­è¨€éªŒè¯è¾“å‡ºï¼Œè¾“å‡ºæ—¥å¿—ã€‚
5. **æŸ¥çœ‹ç»“æœ**ï¼šæŸ¥çœ‹æµ‹è¯•æŠ¥å‘Šå’Œæ—¥å¿—ï¼Œåˆ†ææ¥å£è¡¨ç°ã€‚

---

## ç›®å½•ç»“æ„

```
PythonProject/
â”œâ”€â”€ caseparams/           # æµ‹è¯•ç”¨ä¾‹æ•°æ®ï¼ˆcsv/yaml/excelç­‰ï¼‰
â”œâ”€â”€ common/               # é€šç”¨åŸºç¡€æ¨¡å—ï¼ˆé…ç½®ã€æ—¥å¿—ã€æ–­è¨€ç­‰ï¼‰
â”œâ”€â”€ conf/                 # ç¯å¢ƒ/æ¥å£/æ•°æ®åº“ç­‰é…ç½®
â”œâ”€â”€ data_prepare/         # æ•°æ®å‡†å¤‡ä¸é¢„å¤„ç†ï¼ˆå¦‚é€ æ•°ã€æ•°æ®åº“æ“ä½œç­‰ï¼‰
â”œâ”€â”€ design/               # æµ‹è¯•è®¾è®¡ç›¸å…³ï¼ˆæ–­è¨€æ¨¡æ¿ã€ç”¨ä¾‹ç”Ÿæˆæ¨¡æ¿ç­‰ï¼‰
â”œâ”€â”€ execution/            # æµ‹è¯•æ‰§è¡Œç›¸å…³ï¼ˆå‚æ•°åŒ–ã€æ‰§è¡Œå…¥å£ç­‰ï¼‰
â”œâ”€â”€ log/                  # æ—¥å¿—è¾“å‡ºç›®å½•
â”œâ”€â”€ report/               # æµ‹è¯•æŠ¥å‘Šè¾“å‡ºç›®å½•
â”œâ”€â”€ testcase/             # è‡ªåŠ¨ç”Ÿæˆ/æ‰‹å†™çš„pytestæµ‹è¯•ç”¨ä¾‹è„šæœ¬
â”œâ”€â”€ utils/                # å·¥å…·ç±»ï¼ˆhttpã€jsonã€excelç­‰ï¼‰
â””â”€â”€ README.md             # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

---

## å„ç›®å½•èŒè´£è¯´æ˜

- **caseparams/**  
  å­˜æ”¾æ‰€æœ‰æ¥å£çš„æµ‹è¯•æ•°æ®æ–‡ä»¶ï¼Œæ”¯æŒcsv/yaml/excelç­‰å¤šæ ¼å¼ï¼Œä¾¿äºæ•°æ®é©±åŠ¨ã€‚
- **common/**  
  æ”¾ç½®å…¨å±€é€šç”¨çš„åŸºç¡€èƒ½åŠ›ï¼Œå¦‚é…ç½®åŠ è½½ï¼ˆconfig.pyï¼‰ã€æ—¥å¿—ï¼ˆlog.pyï¼‰ã€æ–­è¨€ï¼ˆassertion.pyï¼‰ç­‰ã€‚
- **conf/**  
  å­˜æ”¾ç¯å¢ƒã€æ¥å£ã€æ•°æ®åº“ç­‰é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒini/yamlç­‰æ ¼å¼ã€‚
- **data_prepare/**  
  æ•°æ®å‡†å¤‡ç›¸å…³ï¼Œå¦‚æ•°æ®åº“æ“ä½œï¼ˆdb_utils.pyï¼‰ã€é€ æ•°è„šæœ¬ï¼ˆdata_factory.pyï¼‰ç­‰ã€‚
- **design/**  
  æµ‹è¯•è®¾è®¡ç›¸å…³ï¼Œå¦‚æ–­è¨€æ¨¡æ¿ï¼ˆassertion_template.pyï¼‰ã€ç”¨ä¾‹ç”Ÿæˆæ¨¡æ¿ï¼ˆtestcase_template.pyï¼‰ç­‰ã€‚
- **execution/**  
  æµ‹è¯•æ‰§è¡Œç›¸å…³ï¼Œå¦‚pytesté’©å­ï¼ˆconftest.pyï¼‰ã€æ‰¹é‡æ‰§è¡Œå™¨ï¼ˆexecutor.pyï¼‰ç­‰ã€‚
- **log/**  
  æ—¥å¿—è¾“å‡ºç›®å½•ï¼Œè‡ªåŠ¨ç”Ÿæˆå’Œè½®è½¬ã€‚
- **report/**  
  æµ‹è¯•æŠ¥å‘Šè¾“å‡ºç›®å½•ï¼Œå­˜æ”¾htmlç­‰æ ¼å¼çš„æµ‹è¯•æŠ¥å‘Šã€‚
- **testcase/**  
  å­˜æ”¾è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹å†™çš„pytestæµ‹è¯•ç”¨ä¾‹è„šæœ¬ã€‚
- **utils/**  
  å·¥å…·ç±»ç›®å½•ï¼Œå°è£…httpã€jsonã€excelç­‰å¸¸ç”¨å·¥å…·ã€‚

---

## ç¯å¢ƒé…ç½®

### Python 3.8.10 å®‰è£…

#### Windows å®‰è£…
1. ä¸‹è½½ Python 3.8.10 å®‰è£…åŒ…ï¼šhttps://www.python.org/downloads/release/python-3810/
2. è¿è¡Œå®‰è£…ç¨‹åºï¼Œå‹¾é€‰ "Add Python 3.8 to PATH"
3. éªŒè¯å®‰è£…ï¼š`python --version` åº”æ˜¾ç¤º `Python 3.8.10`

#### Linux/macOS å®‰è£…
```bash
# ä½¿ç”¨ pyenv å®‰è£… Python 3.8.10
pyenv install 3.8.10
pyenv global 3.8.10

# æˆ–ä½¿ç”¨ conda
conda create -n python38 python=3.8.10
conda activate python38
```

#### éªŒè¯ Python ç‰ˆæœ¬
```bash
python --version
# åº”è¾“å‡º: Python 3.8.10
```

### é¡¹ç›®ä¾èµ–å®‰è£…

```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

# æˆ–ä½¿ç”¨å›½å†…é•œåƒæº
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

### å¤šé…ç½®æ–‡ä»¶åŠ è½½

`InterfaceConfig` ç±»æ”¯æŒåŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶å¹¶è‡ªåŠ¨åˆå¹¶é…ç½®ã€‚æ”¯æŒ YAML å’Œ INI æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚

#### æ”¯æŒçš„é…ç½®æ–‡ä»¶

1. **conf/env.yaml** - ç¯å¢ƒé…ç½®ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒï¼‰
2. **conf/interface_info.yaml** - æ¥å£é…ç½®ä¿¡æ¯
3. **conf/interface.ini** - æ•°æ®åº“ç­‰å…¶ä»–é…ç½®

#### é…ç½®ä¼˜å…ˆçº§

é…ç½®æ–‡ä»¶æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§åŠ è½½å’Œåˆå¹¶ï¼š
1. `env.yaml` - ç¯å¢ƒé…ç½®ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. `interface_info.yaml` - æ¥å£é…ç½®
3. `interface.ini` - å…¶ä»–é…ç½®ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰

#### ä½¿ç”¨æ–¹æ³•

```python
from common.interface_config import InterfaceConfig, get_interface_config

# ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶åˆ—è¡¨
config = InterfaceConfig()

# è·å–å½“å‰ç¯å¢ƒ
current_env = config.get_current_env()  # è¿”å›: 'dev'

# è·å–ç¯å¢ƒé…ç½®
env_config = config.get_env_config()  # è¿”å›å½“å‰ç¯å¢ƒçš„é…ç½®

# è·å–APIåŸºç¡€URL
api_base_url = config.get_api_base_url()  # è¿”å›å½“å‰ç¯å¢ƒçš„APIåŸºç¡€URL

# è·å–ç™»å½•æ¥å£é…ç½®ï¼ˆä¼šè‡ªåŠ¨æ ¹æ®å½“å‰ç¯å¢ƒæ›¿æ¢URLï¼‰
login_config = get_interface_config('user', 'login')

# è·å–æŒ‡å®šç¯å¢ƒçš„æ¥å£é…ç½®
test_login_config = get_interface_config('user', 'login', 'test')
prod_login_config = get_interface_config('user', 'login', 'prod')

# è·å–æ•°æ®åº“é…ç½®
db_config = config.get_database_config()
test_db_config = config.get_database_config('test')
```

#### é…ç½®æ–‡ä»¶æ ¼å¼

**env.yaml æ ¼å¼ï¼š**
```yaml
env:
  current: dev  # å½“å‰ç¯å¢ƒ
  dev:
    host: 127.0.0.1
    db:
      host: 127.0.0.1
      port: 3306
      user: dev_user
      password: dev_pass
      database: dev_db
    api_base_url: http://127.0.0.1:8000/api
  test:
    host: 192.168.1.100
    db:
      host: 192.168.1.100
      port: 3306
      user: test_user
      password: test_pass
      database: test_db
    api_base_url: http://192.168.1.100:8000/api
  prod:
    host: prod.example.com
    db:
      host: prod-db.example.com
      port: 3306
      user: prod_user
      password: prod_pass
      database: prod_db
    api_base_url: https://api.example.com
```

**interface_info.yaml æ ¼å¼ï¼š**
```yaml
interfaces:
  user:
    login:
      url: http://localhost:8080/api/login  # ä¼šè¢«è‡ªåŠ¨æ›¿æ¢ä¸ºå½“å‰ç¯å¢ƒçš„APIåŸºç¡€URL
      method: POST
      headers:
        Content-Type: application/json
      timeout: 30
      description: ç”¨æˆ·ç™»å½•æ¥å£

global:
  default_timeout: 30
  default_headers:
    User-Agent: PythonProject/1.0
    Accept: application/json
  retry_times: 3
  retry_interval: 1
```

**interface.ini æ ¼å¼ï¼š**
```ini
[DATABASE]
host = localhost
user = your_user
password = your_password
database = your_database
```

#### ä¸»è¦åŠŸèƒ½

1. **ç¯å¢ƒç®¡ç†**
   - è‡ªåŠ¨è¯†åˆ«å½“å‰ç¯å¢ƒ
   - æ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼ˆdev/test/prodï¼‰
   - ç¯å¢ƒé—´é…ç½®éš”ç¦»

2. **URLè‡ªåŠ¨æ›¿æ¢**
   - æ¥å£URLä¼šæ ¹æ®å½“å‰ç¯å¢ƒè‡ªåŠ¨æ›¿æ¢åŸºç¡€åœ°å€
   - ä¾‹å¦‚ï¼š`http://localhost:8080/api/login` åœ¨testç¯å¢ƒä¼šå˜æˆ `http://192.168.1.100:8000/api/login`

3. **é…ç½®åˆå¹¶**
   - è‡ªåŠ¨åˆå¹¶å¤šä¸ªé…ç½®æ–‡ä»¶
   - æ”¯æŒé…ç½®è¦†ç›–å’Œæ‰©å±•
   - ä¿æŒé…ç½®çš„å±‚æ¬¡ç»“æ„

4. **ç±»å‹å®‰å…¨**
   - ä½¿ç”¨ç±»å‹æ³¨è§£æé«˜ä»£ç å¯è¯»æ€§
   - æ”¯æŒIDEè‡ªåŠ¨è¡¥å…¨å’Œç±»å‹æ£€æŸ¥

#### ä¾¿æ·å‡½æ•°

```python
# è·å–æ¥å£é…ç½®
from common.interface_config import get_interface_config
config = get_interface_config('user', 'login', 'test')

# è·å–ç¯å¢ƒé…ç½®
from common.interface_config import get_env_config
env_config = get_env_config('prod')
```

#### è‡ªå®šä¹‰é…ç½®æ–‡ä»¶åˆ—è¡¨

```python
# åªåŠ è½½ç‰¹å®šçš„é…ç½®æ–‡ä»¶
custom_config = InterfaceConfig([
    'conf/env.yaml',
    'conf/interface_info.yaml'
])

# æˆ–è€…æ·»åŠ è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
custom_config = InterfaceConfig([
    'conf/env.yaml',
    'conf/interface_info.yaml',
    'conf/custom_config.yaml'
])
```

### ä¼ ç»Ÿé…ç½®æ–¹å¼

- **conf/env.yaml**ï¼šå¤šç¯å¢ƒä¿¡æ¯ï¼ˆdev/test/prodï¼‰ï¼Œå¯é€šè¿‡common/config.pyè‡ªåŠ¨åŠ è½½ã€‚
- **conf/interface.ini**ï¼šæ¥å£åŸºç¡€ä¿¡æ¯é…ç½®ã€‚
- **common/config.py**ï¼šè‡ªåŠ¨åŠ è½½confä¸‹æ‰€æœ‰ini/yamlé…ç½®ï¼Œæ”¯æŒå¤šçº§keyè®¿é—®ã€‚

---

## HTTPå·¥å…·ç±»

### æ¦‚è¿°

`HTTPUtils` ç±»æä¾›äº†å®Œæ•´çš„HTTPè¯·æ±‚åŠŸèƒ½ï¼Œæ”¯æŒæ‰€æœ‰HTTPè¯·æ±‚æ–¹æ³•ï¼šGETã€POSTã€DELETEã€PUTã€PATCHã€HEADã€OPTIONSã€‚

### æ”¯æŒçš„HTTPæ–¹æ³•

- **GET** - è·å–èµ„æº
- **POST** - åˆ›å»ºèµ„æº
- **PUT** - æ›´æ–°èµ„æºï¼ˆå®Œæ•´æ›¿æ¢ï¼‰
- **DELETE** - åˆ é™¤èµ„æº
- **PATCH** - éƒ¨åˆ†æ›´æ–°èµ„æº
- **HEAD** - è·å–å“åº”å¤´ä¿¡æ¯
- **OPTIONS** - è·å–æ”¯æŒçš„HTTPæ–¹æ³•

### ä½¿ç”¨æ–¹æ³•

#### 1. ç±»æ–¹å¼ä½¿ç”¨ï¼ˆæ¨èï¼‰

```python
from utils.http_utils import HTTPUtils

# åˆ›å»ºHTTPå·¥å…·å®ä¾‹
http_utils = HTTPUtils(base_url="https://api.example.com")

# è®¾ç½®é»˜è®¤è¯·æ±‚å¤´
http_utils.set_default_headers({
    'Content-Type': 'application/json',
    'User-Agent': 'PythonProject/1.0'
})

# è®¾ç½®è®¤è¯token
http_utils.set_token("your_token_here")

try:
    # GETè¯·æ±‚
    response = http_utils.get("/users", params={"page": 1, "limit": 10})
    print(f"GETå“åº”: {response}")
    
    # POSTè¯·æ±‚ï¼ˆJSONæ•°æ®ï¼‰
    user_data = {"name": "John", "email": "john@example.com"}
    response = http_utils.post("/users", json_data=user_data)
    print(f"POSTå“åº”: {response}")
    
    # PUTè¯·æ±‚
    update_data = {"name": "John Updated", "status": "active"}
    response = http_utils.put("/users/1", json_data=update_data)
    print(f"PUTå“åº”: {response}")
    
    # DELETEè¯·æ±‚
    response = http_utils.delete("/users/1")
    print(f"DELETEå“åº”: {response}")
    
    # PATCHè¯·æ±‚
    patch_data = {"status": "updated"}
    response = http_utils.patch("/users/1", json_data=patch_data)
    print(f"PATCHå“åº”: {response}")
    
    # HEADè¯·æ±‚
    response = http_utils.head("/users")
    print(f"HEADå“åº”çŠ¶æ€ç : {response.status_code}")
    print(f"HEADå“åº”å¤´: {dict(response.headers)}")
    
    # OPTIONSè¯·æ±‚
    response = http_utils.options("/users")
    print(f"OPTIONSå“åº”çŠ¶æ€ç : {response.status_code}")
    print(f"OPTIONSå“åº”å¤´: {dict(response.headers)}")
    
    # é€šç”¨è¯·æ±‚æ–¹æ³•
    response = http_utils.request("GET", "/users", params={"status": "active"})
    print(f"é€šç”¨è¯·æ±‚å“åº”: {response}")
    
finally:
    # æ¸…ç†ä¼šè¯
    http_utils.clear_session()
```

#### 2. ä¾¿æ·å‡½æ•°ä½¿ç”¨

```python
from utils.http_utils import http_get, http_post, http_put, http_delete, http_patch, http_head, http_options

# GETè¯·æ±‚
response = http_get("https://api.example.com/users", params={"page": 1})

# POSTè¯·æ±‚
user_data = {"name": "John", "email": "john@example.com"}
response = http_post("https://api.example.com/users", json_data=user_data)

# PUTè¯·æ±‚
update_data = {"name": "John Updated"}
response = http_put("https://api.example.com/users/1", json_data=update_data)

# DELETEè¯·æ±‚
response = http_delete("https://api.example.com/users/1")

# PATCHè¯·æ±‚
patch_data = {"status": "active"}
response = http_patch("https://api.example.com/users/1", json_data=patch_data)

# HEADè¯·æ±‚
response = http_head("https://api.example.com/users")

# OPTIONSè¯·æ±‚
response = http_options("https://api.example.com/users")
```

### ä¸»è¦åŠŸèƒ½

1. **ä¼šè¯ç®¡ç†**
   - è‡ªåŠ¨ç»´æŠ¤HTTPä¼šè¯
   - æ”¯æŒä¼šè¯çº§åˆ«çš„è¯·æ±‚å¤´å’Œè®¤è¯
   - æä¾›ä¼šè¯æ¸…ç†åŠŸèƒ½

2. **è¯·æ±‚å¤´ç®¡ç†**
   - æ”¯æŒé»˜è®¤è¯·æ±‚å¤´è®¾ç½®
   - æ”¯æŒåŠ¨æ€æ·»åŠ è®¤è¯token
   - è‡ªåŠ¨åˆå¹¶è‡ªå®šä¹‰è¯·æ±‚å¤´

3. **URLæ„å»º**
   - æ”¯æŒåŸºç¡€URLé…ç½®
   - è‡ªåŠ¨å¤„ç†ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„
   - æ™ºèƒ½URLæ‹¼æ¥

4. **é”™è¯¯å¤„ç†**
   - è‡ªåŠ¨æŠ›å‡ºHTTPé”™è¯¯å¼‚å¸¸
   - æ”¯æŒç½‘ç»œé”™è¯¯å¤„ç†
   - æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

5. **æ—¥å¿—è®°å½•**
   - è‡ªåŠ¨è®°å½•è¯·æ±‚å’Œå“åº”ä¿¡æ¯
   - æ”¯æŒè°ƒè¯•çº§åˆ«çš„è¯¦ç»†æ—¥å¿—
   - è®°å½•è¯·æ±‚å¤´ã€å“åº”å¤´ç­‰ä¿¡æ¯

### ä¸æ¥å£é…ç½®é›†æˆ

```python
from common.interface_config import get_interface_config
from utils.http_utils import HTTPUtils

# è·å–æ¥å£é…ç½®
interface_config = get_interface_config('user', 'login')

# åˆ›å»ºHTTPå·¥å…·å®ä¾‹
http_utils = HTTPUtils(base_url=interface_config.get('base_url', ''))

# å‘é€è¯·æ±‚
response = http_utils.post(
    interface_config['url'],
    json_data=interface_config.get('data'),
    headers=interface_config.get('headers'),
    timeout=interface_config.get('timeout', 30)
)
```

---

## æ•°æ®åº“æ“ä½œå·¥å…·

### æ¦‚è¿°

`RequestDB` ç±»æä¾›äº†å®Œæ•´çš„æ•°æ®åº“æ“ä½œåŠŸèƒ½ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ç±»å‹å’Œå®Œæ•´çš„CRUDæ“ä½œã€‚æ”¯æŒMySQLã€PostgreSQLã€Redisã€SQLiteç­‰æ•°æ®åº“ã€‚

### æ”¯æŒçš„æ•°æ®åº“ç±»å‹

- **MySQL** - å…³ç³»å‹æ•°æ®åº“
- **PostgreSQL** - å…³ç³»å‹æ•°æ®åº“
- **Redis** - é”®å€¼å¯¹æ•°æ®åº“
- **SQLite** - è½»é‡çº§å…³ç³»å‹æ•°æ®åº“

### ä¸»è¦åŠŸèƒ½

1. **å®Œæ•´çš„CRUDæ“ä½œ**
   - **Create** - åˆ›å»ºæ•°æ®
   - **Read** - è¯»å–æ•°æ®
   - **Update** - æ›´æ–°æ•°æ®
   - **Delete** - åˆ é™¤æ•°æ®

2. **æ•°æ®åº“è¿æ¥ç®¡ç†**
   - è‡ªåŠ¨è¿æ¥ç®¡ç†
   - è¿æ¥æ± æ”¯æŒ
   - äº‹åŠ¡å¤„ç†
   - é”™è¯¯å¤„ç†å’Œå›æ»š

3. **å¤šæ•°æ®åº“æ”¯æŒ**
   - ç»Ÿä¸€çš„APIæ¥å£
   - æ•°æ®åº“ç‰¹å®šçš„ä¼˜åŒ–
   - è‡ªåŠ¨SQLé€‚é…

4. **é…ç½®æ–‡ä»¶æ”¯æŒ**
   - ä» `conf/database.yaml` è‡ªåŠ¨åŠ è½½é…ç½®
   - æ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼ˆdev/test/prodï¼‰
   - è‡ªåŠ¨ç¯å¢ƒæ£€æµ‹
   - é…ç½®è¦†ç›–æœºåˆ¶

### é…ç½®æ–‡ä»¶

æ•°æ®åº“è¿æ¥é…ç½®å­˜å‚¨åœ¨ `conf/database.yaml` æ–‡ä»¶ä¸­ï¼š

```yaml
database:
  # é»˜è®¤æ•°æ®åº“ç±»å‹
  default_type: mysql
  
  # MySQLæ•°æ®åº“é…ç½®
  mysql:
    dev:
      host: 127.0.0.1
      port: 3306
      user: dev_user
      password: dev_pass
      database: dev_db
      charset: utf8mb4
      autocommit: true
    test:
      host: 192.168.1.100
      port: 3306
      user: test_user
      password: test_pass
      database: test_db
      charset: utf8mb4
      autocommit: true
    prod:
      host: prod-mysql.example.com
      port: 3306
      user: prod_user
      password: prod_pass
      database: prod_db
      charset: utf8mb4
      autocommit: true
  
  # PostgreSQLæ•°æ®åº“é…ç½®
  postgresql:
    dev:
      host: 127.0.0.1
      port: 5432
      user: dev_user
      password: dev_pass
      database: dev_db
      autocommit: true
    test:
      host: 192.168.1.100
      port: 5432
      user: test_user
      password: test_pass
      database: test_db
      autocommit: true
    prod:
      host: prod-postgres.example.com
      port: 5432
      user: prod_user
      password: prod_pass
      database: prod_db
      autocommit: true
  
  # Redisæ•°æ®åº“é…ç½®
  redis:
    dev:
      host: 127.0.0.1
      port: 6379
      password: null
      db: 0
    test:
      host: 192.168.1.100
      port: 6379
      password: test_redis_pass
      db: 1
    prod:
      host: prod-redis.example.com
      port: 6379
      password: prod_redis_pass
      db: 0
  
  # SQLiteæ•°æ®åº“é…ç½®
  sqlite:
    dev:
      database: dev.db
    test:
      database: test.db
    prod:
      database: prod.db
```

### ä½¿ç”¨æ–¹æ³•

#### 1. ä»é…ç½®æ–‡ä»¶è‡ªåŠ¨è·å–è¿æ¥ä¿¡æ¯ï¼ˆæ¨èï¼‰

```python
from common.requestdb import RequestDB, get_db_connection

# æ–¹å¼1ï¼šæŒ‡å®šæ•°æ®åº“ç±»å‹å’Œç¯å¢ƒ
db = get_db_connection('mysql', 'dev')
if db.connect():
    try:
        result = db.query("SELECT * FROM users")
        print(result)
    finally:
        db.disconnect()

# æ–¹å¼2ï¼šåªæŒ‡å®šç¯å¢ƒï¼Œä½¿ç”¨é»˜è®¤æ•°æ®åº“ç±»å‹
db = RequestDB(env='test')
if db.connect():
    try:
        result = db.query("SELECT * FROM users")
        print(result)
    finally:
        db.disconnect()

# æ–¹å¼3ï¼šåªæŒ‡å®šæ•°æ®åº“ç±»å‹ï¼Œä½¿ç”¨å½“å‰ç¯å¢ƒ
db = RequestDB(db_type='sqlite')
if db.connect():
    try:
        result = db.query("SELECT * FROM users")
        print(result)
    finally:
        db.disconnect()
```

#### 2. æ‰‹åŠ¨æŒ‡å®šè¿æ¥å‚æ•°

```python
from common.requestdb import RequestDB

# åˆ›å»ºæ•°æ®åº“è¿æ¥
db = RequestDB('mysql', {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',
    'password': 'password',
    'database': 'test_db'
})

# è¿æ¥æ•°æ®åº“
if db.connect():
    try:
        # æ‰§è¡ŒCRUDæ“ä½œ
        # ...
    finally:
        # æ–­å¼€è¿æ¥
        db.disconnect()
```

#### 3. MySQLä½¿ç”¨ç¤ºä¾‹

```python
# MySQLé…ç½®
mysql_config = {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',
    'password': 'password',
    'database': 'test_db',
    'charset': 'utf8mb4'
}

# åˆ›å»ºMySQLè¿æ¥
mysql_db = RequestDB('mysql', mysql_config)

if mysql_db.connect():
    try:
        # æŸ¥è¯¢æ“ä½œ (Read)
        users = mysql_db.query("SELECT * FROM users WHERE status = %s", ('active',))
        print(f"æŸ¥è¯¢ç»“æœ: {users}")
        
        # æ’å…¥æ“ä½œ (Create)
        user_data = {
            'name': 'John Doe',
            'email': 'john@example.com',
            'age': 30,
            'status': 'active'
        }
        rows_affected = mysql_db.insert('users', user_data)
        print(f"æ’å…¥è¡Œæ•°: {rows_affected}")
        
        # æ›´æ–°æ“ä½œ (Update)
        update_data = {'status': 'inactive'}
        rows_affected = mysql_db.update('users', update_data, 'id = %s', (1,))
        print(f"æ›´æ–°è¡Œæ•°: {rows_affected}")
        
        # åˆ é™¤æ“ä½œ (Delete)
        rows_affected = mysql_db.delete('users', 'id = %s', (1,))
        print(f"åˆ é™¤è¡Œæ•°: {rows_affected}")
        
        # æ‰§è¡ŒåŸå§‹SQL
        result = mysql_db.execute_raw_sql("SELECT COUNT(*) as count FROM users")
        print(f"ç”¨æˆ·æ€»æ•°: {result}")
        
    finally:
        mysql_db.disconnect()
```

#### 4. SQLiteä½¿ç”¨ç¤ºä¾‹

```python
# SQLiteé…ç½®
sqlite_config = {
    'database': 'test.db'
}

# åˆ›å»ºSQLiteè¿æ¥
sqlite_db = RequestDB('sqlite', sqlite_config)

if sqlite_db.connect():
    try:
        # åˆ›å»ºè¡¨
        sqlite_db.execute_raw_sql("""
            CREATE TABLE IF NOT EXISTS users (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                name TEXT NOT NULL,
                email TEXT UNIQUE,
                age INTEGER
            )
        """)
        
        # æ’å…¥æ•°æ®
        user_data = {
            'name': 'Jane Doe',
            'email': 'jane@example.com',
            'age': 25
        }
        rows_affected = sqlite_db.insert('users', user_data)
        print(f"æ’å…¥è¡Œæ•°: {rows_affected}")
        
        # æŸ¥è¯¢æ•°æ®
        users = sqlite_db.query("SELECT * FROM users WHERE age > ?", (20,))
        print(f"æŸ¥è¯¢ç»“æœ: {users}")
        
    finally:
        sqlite_db.disconnect()
```

#### 5. Redisä½¿ç”¨ç¤ºä¾‹

```python
# Redisé…ç½®
redis_config = {
    'host': 'localhost',
    'port': 6379,
    'password': None,
    'db': 0
}

# åˆ›å»ºRedisè¿æ¥
redis_db = RequestDB('redis', redis_config)

if redis_db.connect():
    try:
        # Redisæ’å…¥æ“ä½œ
        user_data = {
            'name': 'John Doe',
            'email': 'john@example.com',
            'age': '30'
        }
        rows_affected = redis_db.insert('user:1', user_data)
        print(f"æ’å…¥ç»“æœ: {rows_affected}")
        
        # Redisæ›´æ–°æ“ä½œ
        update_data = {'age': '31'}
        rows_affected = redis_db.update('user:1', update_data, 'exists')
        print(f"æ›´æ–°ç»“æœ: {rows_affected}")
        
        # Redisåˆ é™¤æ“ä½œ
        rows_affected = redis_db.delete('user:1', 'exists')
        print(f"åˆ é™¤ç»“æœ: {rows_affected}")
        
    finally:
        redis_db.disconnect()
```

### ä¾¿æ·å‡½æ•°

```python
from common.requestdb import create_db_connection, get_db_connection

# ä½¿ç”¨ä¾¿æ·å‡½æ•°åˆ›å»ºè¿æ¥
mysql_db = create_db_connection('mysql', 
    host='localhost',
    port=3306,
    user='root',
    password='password',
    database='test_db'
)

if mysql_db.connect():
    try:
        result = mysql_db.query("SELECT * FROM users")
        print(result)
    finally:
        mysql_db.disconnect()

# ä»é…ç½®æ–‡ä»¶è·å–è¿æ¥
db = get_db_connection('mysql', 'dev')
if db.connect():
    try:
        result = db.query("SELECT * FROM users")
        print(result)
    finally:
        db.disconnect()
```

### é«˜çº§åŠŸèƒ½

#### 1. äº‹åŠ¡å¤„ç†

```python
# äº‹åŠ¡å¤„ç†ç¤ºä¾‹
mysql_db = RequestDB('mysql', mysql_config)

if mysql_db.connect():
    try:
        # å¼€å§‹äº‹åŠ¡
        mysql_db.db_connection.connection.begin()
        
        try:
            # æ‰§è¡Œå¤šä¸ªæ“ä½œ
            mysql_db.insert('users', {'name': 'User1', 'email': 'user1@example.com'})
            mysql_db.insert('users', {'name': 'User2', 'email': 'user2@example.com'})
            
            # æäº¤äº‹åŠ¡
            mysql_db.db_connection.connection.commit()
            print("äº‹åŠ¡æäº¤æˆåŠŸ")
            
        except Exception as e:
            # å›æ»šäº‹åŠ¡
            mysql_db.db_connection.connection.rollback()
            print(f"äº‹åŠ¡å›æ»š: {e}")
            
    finally:
        mysql_db.disconnect()
```

#### 2. å¤æ‚æŸ¥è¯¢

```python
# å¤æ‚æŸ¥è¯¢ç¤ºä¾‹
mysql_db = RequestDB('mysql', mysql_config)

if mysql_db.connect():
    try:
        # è”è¡¨æŸ¥è¯¢
        sql = """
            SELECT u.name, u.email, o.order_id, o.total_amount
            FROM users u
            LEFT JOIN orders o ON u.id = o.user_id
            WHERE u.status = %s AND o.total_amount > %s
            ORDER BY o.total_amount DESC
        """
        result = mysql_db.query(sql, ('active', 100))
        print(f"è”è¡¨æŸ¥è¯¢ç»“æœ: {result}")
        
        # èšåˆæŸ¥è¯¢
        sql = """
            SELECT 
                category,
                COUNT(*) as count,
                AVG(price) as avg_price,
                SUM(price) as total_amount
            FROM products
            GROUP BY category
            HAVING COUNT(*) > %s
        """
        result = mysql_db.query(sql, (5,))
        print(f"èšåˆæŸ¥è¯¢ç»“æœ: {result}")
        
    finally:
        mysql_db.disconnect()
```

### ä¸æ¥å£é…ç½®é›†æˆ

```python
from common.interface_config import get_env_config
from common.requestdb import RequestDB

# ä»ç¯å¢ƒé…ç½®è·å–æ•°æ®åº“é…ç½®
env_config = get_env_config('dev')
db_config = env_config.get('db', {})

# åˆ›å»ºæ•°æ®åº“è¿æ¥
db = RequestDB('mysql', db_config)

if db.connect():
    try:
        # æ‰§è¡Œæ•°æ®åº“æ“ä½œ
        result = db.query("SELECT * FROM test_table")
        print(result)
    finally:
        db.disconnect()
```

### é…ç½®ä¼˜å…ˆçº§

1. **æ‰‹åŠ¨æŒ‡å®šçš„è¿æ¥å‚æ•°** - æœ€é«˜ä¼˜å…ˆçº§
2. **é…ç½®æ–‡ä»¶ä¸­çš„ç¯å¢ƒé…ç½®** - ä¸­ç­‰ä¼˜å…ˆçº§
3. **é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤é…ç½®** - æœ€ä½ä¼˜å…ˆçº§ï¼ˆdevç¯å¢ƒé…ç½®ä½œä¸ºé»˜è®¤é…ç½®ï¼‰

### ç¯å¢ƒæ£€æµ‹

- è‡ªåŠ¨ä» `conf/env.yaml` è·å–å½“å‰ç¯å¢ƒ
- æ”¯æŒæ‰‹åŠ¨æŒ‡å®šç¯å¢ƒå‚æ•°
- ç¯å¢ƒä¸å­˜åœ¨æ—¶ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„devç¯å¢ƒé…ç½®
- å¦‚æœdevç¯å¢ƒä¸å­˜åœ¨ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªå¯ç”¨çš„ç¯å¢ƒé…ç½®
- åªæœ‰åœ¨é…ç½®æ–‡ä»¶å®Œå…¨ä¸å¯ç”¨æ—¶æ‰ä½¿ç”¨å†…ç½®çš„fallbacké…ç½®

### é…ç½®æ¥æº

æ‰€æœ‰çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯éƒ½æ¥è‡ª `conf/database.yaml` é…ç½®æ–‡ä»¶ï¼š

- **é»˜è®¤é…ç½®**ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„devç¯å¢ƒé…ç½®
- **ç¯å¢ƒé…ç½®**ï¼šæ ¹æ®æŒ‡å®šçš„ç¯å¢ƒï¼ˆdev/test/prodï¼‰è·å–å¯¹åº”é…ç½®
- **fallbacké…ç½®**ï¼šä»…åœ¨é…ç½®æ–‡ä»¶ä¸å¯ç”¨æ—¶ä½¿ç”¨å†…ç½®çš„é»˜è®¤å€¼

### é…ç½®åŠ è½½é€»è¾‘

1. **ä¼˜å…ˆä½¿ç”¨æ‰‹åŠ¨æŒ‡å®šçš„è¿æ¥å‚æ•°**
2. **å…¶æ¬¡ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„æŒ‡å®šç¯å¢ƒé…ç½®**
3. **å†æ¬¡ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„devç¯å¢ƒé…ç½®ä½œä¸ºé»˜è®¤é…ç½®**
4. **æœ€åä½¿ç”¨å†…ç½®çš„fallbacké…ç½®ï¼ˆä»…åœ¨é…ç½®æ–‡ä»¶ä¸å¯ç”¨æ—¶ï¼‰** 

---

## æ•°æ®é©±åŠ¨æµ‹è¯•

### æ¦‚è¿°

é¡¹ç›®æ”¯æŒè‡ªåŠ¨åŠ è½½ `caseparams` ç›®å½•ä¸‹æ‰€æœ‰æ ¼å¼çš„æ–‡ä»¶ä½œä¸ºæ•°æ®é©±åŠ¨æµ‹è¯•ï¼Œæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼å’Œçµæ´»çš„åŠ è½½æ–¹å¼ã€‚

### æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

- **CSV** - é€—å·åˆ†éš”å€¼æ–‡ä»¶
- **YAML/YML** - YAMLæ ¼å¼æ–‡ä»¶
- **JSON** - JSONæ ¼å¼æ–‡ä»¶
- **Excel** - XLSX/XLSæ ¼å¼æ–‡ä»¶
- **TSV** - åˆ¶è¡¨ç¬¦åˆ†éš”å€¼æ–‡ä»¶

### ä½¿ç”¨æ–¹æ³•

#### 1. åŠ è½½æ‰€æœ‰æµ‹è¯•æ•°æ®

```python
from common.get_caseparams import get_all_test_data

# åŠ è½½caseparamsç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æ•°æ®
all_data = get_all_test_data()

# éå†æ‰€æœ‰æ–‡ä»¶çš„æ•°æ®
for file_name, data in all_data.items():
    print(f"æ–‡ä»¶: {file_name}, æ•°æ®æ¡æ•°: {len(data)}")
    for case in data:
        # å¤„ç†æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹
        case_id = case.get('case_id')
        description = case.get('description')
        url = case.get('url')
        method = case.get('method')
        params = case.get('params')
        expected = case.get('expected_result')
```

#### 2. æŒ‰æ–‡ä»¶ç±»å‹åŠ è½½æ•°æ®

```python
from common.get_caseparams import (
    get_csv_test_data,
    get_yaml_test_data,
    get_json_test_data,
    get_excel_test_data
)

# åŠ è½½ç‰¹å®šç±»å‹çš„æ–‡ä»¶æ•°æ®
csv_data = get_csv_test_data()      # æ‰€æœ‰CSVæ–‡ä»¶æ•°æ®
yaml_data = get_yaml_test_data()    # æ‰€æœ‰YAMLæ–‡ä»¶æ•°æ®
json_data = get_json_test_data()    # æ‰€æœ‰JSONæ–‡ä»¶æ•°æ®
excel_data = get_excel_test_data()  # æ‰€æœ‰Excelæ–‡ä»¶æ•°æ®
```

#### 3. æŒ‰ç±»å‹åŠ è½½ç‰¹å®šæ ¼å¼æ•°æ®

```python
from common.get_caseparams import load_caseparams_by_type

# åŠ è½½æŒ‡å®šç±»å‹çš„æ‰€æœ‰æ–‡ä»¶æ•°æ®
csv_data = load_caseparams_by_type('csv')
yaml_data = load_caseparams_by_type('yaml')
json_data = load_caseparams_by_type('json')
excel_data = load_caseparams_by_type('xlsx')
```

#### 4. è·å–å¯ç”¨æ–‡ä»¶åˆ—è¡¨

```python
from common.get_caseparams import get_available_test_files

# è·å–æ‰€æœ‰å¯ç”¨çš„æµ‹è¯•æ–‡ä»¶è·¯å¾„
available_files = get_available_test_files()
for file_path in available_files:
    print(f"å¯ç”¨æ–‡ä»¶: {file_path}")
```

### æ•°æ®é©±åŠ¨æµ‹è¯•ç¤ºä¾‹

#### æ–¹å¼1: ç±»æ–¹æ³•æ•°æ®é©±åŠ¨

```python
import pytest
from common.get_caseparams import get_all_test_data
from utils.http_utils import http_get, http_post

class TestDataDriven:
    def test_all_files_data_driven(self):
        """æµ‹è¯•æ‰€æœ‰æ–‡ä»¶çš„æ•°æ®é©±åŠ¨"""
        all_data = get_all_test_data()
        for file_name, data in all_data.items():
            for case in data:
                self._execute_test_case(case)
    
    def _execute_test_case(self, case):
        """æ‰§è¡Œå•ä¸ªæµ‹è¯•ç”¨ä¾‹"""
        url = case.get('url')
        method = case.get('method', 'GET').upper()
        params = case.get('params', {})
        
        if method == 'GET':
            resp = http_get(url, params=params)
        elif method == 'POST':
            resp = http_post(url, json_data=params)
        
        # è¿›è¡Œæ–­è¨€
        expected = case.get('expected_result', {})
        for k, v in expected.items():
            assert k in resp
            assert resp[k] == v
```

#### æ–¹å¼2: pytestå‚æ•°åŒ–æ•°æ®é©±åŠ¨

```python
import pytest
from common.get_caseparams import load_caseparams_by_type

# åŠ è½½CSVæ•°æ®ç”¨äºå‚æ•°åŒ–
csv_data = load_caseparams_by_type('csv')

@pytest.mark.parametrize("case", csv_data)
def test_csv_parameterized(case):
    """ä½¿ç”¨pytestå‚æ•°åŒ–çš„CSVæ•°æ®é©±åŠ¨æµ‹è¯•"""
    url = case.get('url')
    method = case.get('method', 'GET').upper()
    params = case.get('params', {})
    
    if method == 'GET':
        resp = http_get(url, params=params)
    elif method == 'POST':
        resp = http_post(url, json_data=params)
    
    # è¿›è¡Œæ–­è¨€
    expected = case.get('expected_result', {})
    for k, v in expected.items():
        assert k in resp
        assert resp[k] == v
```

#### æ–¹å¼3: æŒ‰æ–‡ä»¶åˆ†åˆ«æµ‹è¯•

```python
from common.get_caseparams import get_all_test_data

def test_http_data_file():
    """æµ‹è¯•HTTPæ•°æ®æ–‡ä»¶"""
    all_data = get_all_test_data()
    http_data = all_data.get('test_http_data', [])
    
    for case in http_data:
        url = case.get('url')
        method = case.get('method', 'GET').upper()
        params = case.get('params', {})
        
        if method == 'GET':
            resp = http_get(url, params=params)
        elif method == 'POST':
            resp = http_post(url, json_data=params)
        
        # è¿›è¡Œæ–­è¨€
        expected = case.get('expected_result', {})
        for k, v in expected.items():
            assert k in resp
            assert resp[k] == v
```

### æ–‡ä»¶æ ¼å¼è¦æ±‚

#### CSVæ ¼å¼
```csv
case_id,description,url,method,params,expected_result
1,æµ‹è¯•GETè¯·æ±‚,https://api.example.com/get,GET,"{""key"": ""value""}","{""status"": ""success""}"
2,æµ‹è¯•POSTè¯·æ±‚,https://api.example.com/post,POST,"{""data"": ""test""}","{""id"": 1}"
```

#### YAMLæ ¼å¼
```yaml
- case_id: 1
  description: æ­£å¸¸è¯·æ±‚-ç®€å•é—®é¢˜
  url: http://localhost:8688/api/chatGatWay-internal
  method: POST
  params:
    message: ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
    user_id: user001
  expected_result:
    code: 0
    msg: success
    data:
      reply: ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œé€‚åˆå‡ºè¡Œã€‚

- case_id: 2
  description: å¼‚å¸¸è¯·æ±‚-ç¼ºå°‘messageå‚æ•°
  url: http://localhost:8688/api/chatGatWay-internal
  method: POST
  params:
    user_id: user002
  expected_result:
    code: 400
    msg: å‚æ•°ç¼ºå¤±: message
    data: {}
```

#### JSONæ ¼å¼
```json
[
  {
    "case_id": 1,
    "description": "æµ‹è¯•ç”¨ä¾‹1",
    "url": "https://api.example.com/test",
    "method": "GET",
    "params": {},
    "expected_result": {
      "status": "success"
    }
  }
]
```

### ä¸»è¦åŠŸèƒ½

1. **è‡ªåŠ¨æ–‡ä»¶å‘ç°** - è‡ªåŠ¨æ‰«æ `caseparams` ç›®å½•ä¸‹çš„æ‰€æœ‰æ”¯æŒæ ¼å¼æ–‡ä»¶
2. **å¤šæ ¼å¼æ”¯æŒ** - æ”¯æŒCSVã€YAMLã€JSONã€Excelã€TSVç­‰å¤šç§æ ¼å¼
3. **çµæ´»åŠ è½½** - æ”¯æŒæŒ‰ç±»å‹åŠ è½½ã€æŒ‰æ–‡ä»¶åŠ è½½ã€å…¨éƒ¨åŠ è½½ç­‰å¤šç§æ–¹å¼
4. **é”™è¯¯å¤„ç†** - æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’ŒåŠ è½½çŠ¶æ€åé¦ˆ
5. **è·¯å¾„è§£æ** - è‡ªåŠ¨å¤„ç†ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„è§£æ

### ä¾¿æ·å‡½æ•°

- `get_all_test_data()` - è·å–æ‰€æœ‰æµ‹è¯•æ•°æ®
- `get_csv_test_data()` - è·å–æ‰€æœ‰CSVæµ‹è¯•æ•°æ®
- `get_yaml_test_data()` - è·å–æ‰€æœ‰YAMLæµ‹è¯•æ•°æ®
- `get_json_test_data()` - è·å–æ‰€æœ‰JSONæµ‹è¯•æ•°æ®
- `get_excel_test_data()` - è·å–æ‰€æœ‰Excelæµ‹è¯•æ•°æ®
- `load_caseparams_by_type(file_type)` - æŒ‰ç±»å‹åŠ è½½æµ‹è¯•æ•°æ®
- `get_available_test_files()` - è·å–æ‰€æœ‰å¯ç”¨æµ‹è¯•æ–‡ä»¶ 

---

## JSONæ–‡ä»¶è¯»å–å·¥å…·

### æ¦‚è¿°

é¡¹ç›®æä¾›äº†å¼ºå¤§çš„JSONæ–‡ä»¶è¯»å–å·¥å…·ï¼Œæ”¯æŒåŠ è½½ã€è§£æã€è¯»å–JSONæ–‡ä»¶ï¼ŒåŒ…æ‹¬å¤šå±‚åµŒå¥—ç»“æ„ã€‚è¯¥å·¥å…·æä¾›äº†å®Œæ•´çš„JSONæ“ä½œåŠŸèƒ½ï¼ŒåŒ…æ‹¬è·¯å¾„æŸ¥è¯¢ã€æ•°æ®ä¿®æ”¹ã€æœç´¢ã€éªŒè¯ç­‰ã€‚

### ä¸»è¦åŠŸèƒ½

1. **å¤šå±‚åµŒå¥—æ”¯æŒ** - æ”¯æŒä»»æ„æ·±åº¦çš„JSONåµŒå¥—ç»“æ„
2. **è·¯å¾„æŸ¥è¯¢** - æ”¯æŒç‚¹å·åˆ†éš”å’Œæ•°ç»„ç´¢å¼•çš„è·¯å¾„æŸ¥è¯¢
3. **æ•°æ®ä¿®æ”¹** - æ”¯æŒè®¾ç½®ã€åˆ é™¤JSONä¸­çš„å€¼
4. **æœç´¢åŠŸèƒ½** - æ”¯æŒåœ¨JSONä¸­æœç´¢æŒ‡å®šé”®çš„æ‰€æœ‰å€¼
5. **ç»“æ„åˆ†æ** - è·å–JSONç»“æ„ä¿¡æ¯
6. **SchemaéªŒè¯** - éªŒè¯JSONæ•°æ®æ˜¯å¦ç¬¦åˆæŒ‡å®šschema
7. **æ–‡ä»¶æ“ä½œ** - æ”¯æŒè¯»å–ã€å†™å…¥ã€åˆå¹¶JSONæ–‡ä»¶

### ä½¿ç”¨æ–¹æ³•

#### 1. åŸºæœ¬ä½¿ç”¨

```python
from utils.read_jsonfile_utils import JSONFileReader

# åˆ›å»ºJSONè¯»å–å™¨
reader = JSONFileReader("config.json")

# è·å–å®Œæ•´æ•°æ®
data = reader.get_data()

# æ ¹æ®è·¯å¾„è·å–å€¼
username = reader.get_value("user.name")
age = reader.get_value("user.profile.age")
first_item = reader.get_value("items[0]")
nested_value = reader.get_value("user.addresses[0].city")
```

#### 2. è·¯å¾„æŸ¥è¯¢è¯­æ³•

æ”¯æŒå¤šç§è·¯å¾„æŸ¥è¯¢è¯­æ³•ï¼š

```python
# å¯¹è±¡å±æ€§è®¿é—®
reader.get_value("user.name")                    # è®¿é—®userå¯¹è±¡çš„nameå±æ€§

# æ•°ç»„ç´¢å¼•è®¿é—®
reader.get_value("users[0]")                    # è®¿é—®usersæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
reader.get_value("users[0].profile.age")        # è®¿é—®åµŒå¥—ç»“æ„

# æ··åˆè·¯å¾„
reader.get_value("data.items[1].properties.name")  # å¤æ‚åµŒå¥—è·¯å¾„
```

#### 3. æ•°æ®ä¿®æ”¹

```python
# è®¾ç½®å€¼
reader.set_value("user.phone", "13800138000")
reader.set_value("settings.theme", "dark")
reader.set_value("users[0].profile.email", "new@example.com")

# åˆ é™¤å€¼
reader.delete_value("user.phone")
reader.delete_value("users[0].profile.email")

# ä¿å­˜ä¿®æ”¹
reader.save_file("updated_config.json")
```

#### 4. æœç´¢åŠŸèƒ½

```python
# æœç´¢æ‰€æœ‰åä¸º"city"çš„å­—æ®µ
city_results = reader.search_values("city")
for path, value in city_results:
    print(f"æ‰¾åˆ° {path}: {value}")

# æœç´¢æ‰€æœ‰åä¸º"theme"çš„å­—æ®µ
theme_results = reader.search_values("theme")
for path, value in theme_results:
    print(f"æ‰¾åˆ° {path}: {value}")
```

#### 5. ç»“æ„åˆ†æ

```python
# è·å–JSONç»“æ„ä¿¡æ¯
structure = reader.get_structure(max_depth=3)
print(f"JSONç»“æ„: {structure}")

# ç»“æ„ä¿¡æ¯åŒ…å«ï¼š
# - type: æ•°æ®ç±»å‹ (dict, list, string, number, boolean)
# - keys: å¯¹è±¡çš„é”®åˆ—è¡¨
# - length: æ•°ç»„çš„é•¿åº¦
# - children: å­ç»“æ„ä¿¡æ¯
```

#### 6. SchemaéªŒè¯

```python
# å®šä¹‰schema
schema = {
    "type": "object",
    "properties": {
        "user": {
            "type": "object",
            "properties": {
                "id": {"type": "number"},
                "name": {"type": "string"}
            },
            "required": ["id", "name"]
        }
    }
}

# éªŒè¯æ•°æ®
is_valid, errors = reader.validate_schema(schema)
if not is_valid:
    for error in errors:
        print(f"éªŒè¯é”™è¯¯: {error}")
```

#### 7. ä»å­—ç¬¦ä¸²åŠ è½½

```python
# ä»å­—ç¬¦ä¸²åŠ è½½JSON
json_string = '{"name": "å¼ ä¸‰", "age": 25}'
reader = JSONFileReader()
reader.load_string(json_string)

# è·å–å€¼
name = reader.get_value("name")  # "å¼ ä¸‰"
age = reader.get_value("age")    # 25
```

### ä¾¿æ·å‡½æ•°

#### åŸºæœ¬æ“ä½œ

```python
from utils.read_jsonfile_utils import (
    read_json_file,
    get_json_value,
    write_json_file,
    merge_json_files
)

# è¯»å–JSONæ–‡ä»¶
data = read_json_file("config.json")

# è·å–æŒ‡å®šè·¯å¾„çš„å€¼
value = get_json_value("config.json", "user.name", default="é»˜è®¤å€¼")

# å†™å…¥JSONæ–‡ä»¶
write_json_file("output.json", data, indent=2)

# åˆå¹¶å¤šä¸ªJSONæ–‡ä»¶
merge_json_files(["file1.json", "file2.json"], "merged.json")
```

### å¤æ‚ç¤ºä¾‹

```python
from utils.read_jsonfile_utils import JSONFileReader

# å¤æ‚çš„JSONæ•°æ®ç»“æ„
complex_data = {
    "users": [
        {
            "id": 1,
            "name": "å¼ ä¸‰",
            "profile": {
                "age": 25,
                "email": "zhangsan@example.com",
                "addresses": [
                    {"type": "home", "city": "åŒ—äº¬"},
                    {"type": "work", "city": "ä¸Šæµ·"}
                ],
                "preferences": {
                    "theme": "dark",
                    "language": "zh-CN"
                }
            }
        }
    ],
    "settings": {
        "app": {
            "version": "1.0.0",
            "debug": True
        }
    }
}

# åˆ›å»ºè¯»å–å™¨
reader = JSONFileReader()
reader.load_string(json.dumps(complex_data))

# å¤æ‚è·¯å¾„æŸ¥è¯¢
first_user_name = reader.get_value("users[0].name")                    # "å¼ ä¸‰"
first_user_age = reader.get_value("users[0].profile.age")              # 25
first_address = reader.get_value("users[0].profile.addresses[0]")      # {"type": "home", "city": "åŒ—äº¬"}
theme = reader.get_value("users[0].profile.preferences.theme")         # "dark"
app_version = reader.get_value("settings.app.version")                 # "1.0.0"

# æœç´¢æ‰€æœ‰åŸå¸‚
city_results = reader.search_values("city")
# ç»“æœ: [("users[0].profile.addresses[0].city", "åŒ—äº¬"), ("users[0].profile.addresses[1].city", "ä¸Šæµ·")]

# è®¾ç½®æ–°å€¼
reader.set_value("users[0].profile.phone", "13800138000")
reader.set_value("settings.app.new_feature", True)

# è·å–ç»“æ„ä¿¡æ¯
structure = reader.get_structure(max_depth=2)
```

### é”™è¯¯å¤„ç†

å·¥å…·æä¾›äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

```python
# æ–‡ä»¶ä¸å­˜åœ¨
reader = JSONFileReader("nonexistent.json")
# è¾“å‡º: [ERROR] æ–‡ä»¶ä¸å­˜åœ¨: nonexistent.json

# JSONæ ¼å¼é”™è¯¯
reader.load_string('{"invalid": json}')
# è¾“å‡º: [ERROR] JSONå­—ç¬¦ä¸²æ ¼å¼é”™è¯¯: Expecting ',' delimiter

# è·¯å¾„ä¸å­˜åœ¨
value = reader.get_value("nonexistent.path", default="é»˜è®¤å€¼")
# è¿”å›: "é»˜è®¤å€¼"

# æ•°ç»„è¶Šç•Œ
value = reader.get_value("users[999].name", default="é»˜è®¤å€¼")
# è¿”å›: "é»˜è®¤å€¼"
```

### æ€§èƒ½ä¼˜åŒ–

- **å»¶è¿ŸåŠ è½½** - åªæœ‰åœ¨éœ€è¦æ—¶æ‰åŠ è½½æ–‡ä»¶
- **è·¯å¾„ç¼“å­˜** - è§£æè¿‡çš„è·¯å¾„ä¼šè¢«ç¼“å­˜ä»¥æé«˜æ€§èƒ½
- **å†…å­˜ä¼˜åŒ–** - æ”¯æŒå¤§æ–‡ä»¶çš„åˆ†å—å¤„ç†
- **é”™è¯¯æ¢å¤** - æä¾›é»˜è®¤å€¼å’Œé”™è¯¯æ¢å¤æœºåˆ¶

### ä¸»è¦ç‰¹æ€§

1. **ç±»å‹å®‰å…¨** - ä½¿ç”¨ç±»å‹æç¤ºç¡®ä¿ä»£ç è´¨é‡
2. **é”™è¯¯å¤„ç†** - å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯ä¿¡æ¯
3. **æ—¥å¿—è®°å½•** - è¯¦ç»†çš„æ“ä½œæ—¥å¿—
4. **ç¼–ç æ”¯æŒ** - æ”¯æŒå¤šç§æ–‡ä»¶ç¼–ç 
5. **Unicodeæ”¯æŒ** - å®Œæ•´æ”¯æŒä¸­æ–‡å­—ç¬¦
6. **å‘åå…¼å®¹** - ä¿æŒä¸åŸæœ‰APIçš„å…¼å®¹æ€§ 

---

## MQæ¶ˆæ¯é˜Ÿåˆ—å·¥å…·

### æ¦‚è¿°

é¡¹ç›®æä¾›äº†å®Œæ•´çš„MQï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰å·¥å…·ï¼Œæ”¯æŒRabbitMQå’ŒRocketMQçš„æ¶ˆæ¯å‘é€å’Œæ¶ˆè´¹ã€‚è¯¥å·¥å…·æ”¯æŒä»é…ç½®æ–‡ä»¶åŠ è½½MQé…ç½®ä¿¡æ¯ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„æ¶ˆæ¯å‘é€å’Œæ¶ˆè´¹æ¥å£ã€‚

### æ”¯æŒçš„æ¶ˆæ¯é˜Ÿåˆ—

1. **RabbitMQ** - æ”¯æŒäº¤æ¢æœºã€é˜Ÿåˆ—ã€ç»‘å®šç­‰å®Œæ•´åŠŸèƒ½
2. **RocketMQ** - æ”¯æŒä¸»é¢˜ã€æ ‡ç­¾ã€æ¶ˆè´¹è€…ç»„ç­‰åŠŸèƒ½

### é…ç½®æ–‡ä»¶

MQé…ç½®ä¿¡æ¯å­˜å‚¨åœ¨ `conf/mq.yaml` æ–‡ä»¶ä¸­ï¼Œæ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼š

```yaml
mq:
  default_type: rabbitmq
  
  rabbitmq:
    dev:
      host: localhost
      port: 5672
      username: guest
      password: guest
      virtual_host: /
      exchanges:
        test_exchange:
          name: test_exchange
          type: direct
          durable: true
      queues:
        test_queue:
          name: test_queue
          durable: true
      bindings:
        test_binding:
          exchange: test_exchange
          queue: test_queue
          routing_key: test_key
  
  rocketmq:
    dev:
      name_server: localhost:9876
      producer_group: test_producer_group
      consumer_group: test_consumer_group
      producer:
        send_msg_timeout: 3000
      consumer:
        topics:
          test_topic:
            name: test_topic
            tags: ["test_tag"]
```

### ä½¿ç”¨æ–¹æ³•

#### 1. åŸºæœ¬ä½¿ç”¨

```python
from common.mq_utils import MQManager
import json

# åˆ›å»ºMQç®¡ç†å™¨
manager = MQManager(env='dev')

# å‘é€RabbitMQæ¶ˆæ¯
message = json.dumps({"id": 1, "content": "æµ‹è¯•æ¶ˆæ¯"})
success = manager.send_message('rabbitmq', message, 
                            exchange='test_exchange', routing_key='test_key')

# å‘é€RocketMQæ¶ˆæ¯
success = manager.send_message('rocketmq', message, 
                            topic='test_topic', tags='test_tag')
```

#### 2. RabbitMQæ“ä½œ

```python
from common.mq_utils import RabbitMQConnection, MQManager

# è·å–RabbitMQè¿æ¥
manager = MQManager()
connection = manager.get_connection('rabbitmq')

if connection.connect():
    # å£°æ˜äº¤æ¢æœº
    connection.declare_exchange('test_exchange', 'direct')
    
    # å£°æ˜é˜Ÿåˆ—
    connection.declare_queue('test_queue')
    
    # ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº
    connection.bind_queue('test_queue', 'test_exchange', 'test_key')
    
    # å‘é€æ¶ˆæ¯
    message = json.dumps({"content": "RabbitMQæµ‹è¯•æ¶ˆæ¯"})
    connection.publish_message('test_exchange', 'test_key', message)
    
    # æ¶ˆè´¹æ¶ˆæ¯
    def callback(ch, method, properties, body):
        print(f"æ”¶åˆ°æ¶ˆæ¯: {body.decode()}")
        ch.basic_ack(delivery_tag=method.delivery_tag)
    
    connection.consume_message('test_queue', callback)
    
    # æ–­å¼€è¿æ¥
    connection.disconnect()
```

#### 3. RocketMQæ“ä½œ

```python
from common.mq_utils import RocketMQConnection, MQManager

# è·å–RocketMQè¿æ¥
manager = MQManager()
connection = manager.get_connection('rocketmq')

if connection.connect():
    # å‘é€æ¶ˆæ¯
    message = json.dumps({"content": "RocketMQæµ‹è¯•æ¶ˆæ¯"})
    connection.send_message('test_topic', message, 'test_tag')
    
    # æ¶ˆè´¹æ¶ˆæ¯
    def callback(msg):
        print(f"æ”¶åˆ°æ¶ˆæ¯: {msg.body.decode()}")
        return True  # æ¶ˆè´¹æˆåŠŸ
    
    connection.start_consumer('test_topic', callback, tags='test_tag')
    
    # æ–­å¼€è¿æ¥
    connection.disconnect()
```

#### 4. ä¾¿æ·å‡½æ•°

```python
from common.mq_utils import (
    send_rabbitmq_message,
    send_rocketmq_message,
    consume_rabbitmq_message,
    consume_rocketmq_message
)

# å‘é€æ¶ˆæ¯
message = json.dumps({"content": "ä¾¿æ·å‡½æ•°æµ‹è¯•"})

# RabbitMQ
send_rabbitmq_message(message, 'test_exchange', 'test_key')

# RocketMQ
send_rocketmq_message(message, 'test_topic', 'test_tag')

# æ¶ˆè´¹æ¶ˆæ¯
def rabbitmq_callback(ch, method, properties, body):
    print(f"RabbitMQæ¶ˆæ¯: {body.decode()}")
    ch.basic_ack(delivery_tag=method.delivery_tag)

def rocketmq_callback(msg):
    print(f"RocketMQæ¶ˆæ¯: {msg.body.decode()}")
    return True

consume_rabbitmq_message(rabbitmq_callback, 'test_queue')
consume_rocketmq_message(rocketmq_callback, 'test_topic')
```

### é«˜çº§åŠŸèƒ½

#### 1. å¤šç¯å¢ƒæ”¯æŒ

```python
# å¼€å‘ç¯å¢ƒ
manager = MQManager(env='dev')

# æµ‹è¯•ç¯å¢ƒ
manager = MQManager(env='test')

# ç”Ÿäº§ç¯å¢ƒ
manager = MQManager(env='prod')
```

#### 2. æ¶ˆæ¯å±æ€§è®¾ç½®

```python
# RabbitMQæ¶ˆæ¯å±æ€§
properties = {
    'delivery_mode': 2,  # æŒä¹…åŒ–æ¶ˆæ¯
    'content_type': 'application/json',
    'headers': {'custom_header': 'value'}
}

connection.publish_message('exchange', 'routing_key', message, properties)

# RocketMQæ¶ˆæ¯å±æ€§
connection.send_message('topic', message, 'tag', 'key', delay_level=1)
```

#### 3. æ‰¹é‡æ“ä½œ

```python
# æ‰¹é‡å‘é€æ¶ˆæ¯
messages = [
    {"id": 1, "content": "æ¶ˆæ¯1"},
    {"id": 2, "content": "æ¶ˆæ¯2"},
    {"id": 3, "content": "æ¶ˆæ¯3"}
]

for msg in messages:
    message = json.dumps(msg)
    manager.send_message('rabbitmq', message, 
                       exchange='test_exchange', routing_key='test_key')
```

#### 4. é”™è¯¯å¤„ç†

```python
try:
    success = manager.send_message('rabbitmq', message)
    if not success:
        print("æ¶ˆæ¯å‘é€å¤±è´¥")
except Exception as e:
    print(f"å‘é€æ¶ˆæ¯æ—¶å‘ç”Ÿé”™è¯¯: {e}")
```

### é…ç½®è¯´æ˜

#### RabbitMQé…ç½®

```yaml
rabbitmq:
  dev:
    host: localhost              # ä¸»æœºåœ°å€
    port: 5672                   # ç«¯å£
    username: guest              # ç”¨æˆ·å
    password: guest              # å¯†ç 
    virtual_host: /              # è™šæ‹Ÿä¸»æœº
    connection_timeout: 30       # è¿æ¥è¶…æ—¶
    heartbeat_interval: 600      # å¿ƒè·³é—´éš”
    exchanges:                   # äº¤æ¢æœºé…ç½®
      test_exchange:
        name: test_exchange
        type: direct             # ç±»å‹: direct, fanout, topic
        durable: true
        auto_delete: false
    queues:                      # é˜Ÿåˆ—é…ç½®
      test_queue:
        name: test_queue
        durable: true
        auto_delete: false
        arguments: {}
    bindings:                    # ç»‘å®šå…³ç³»
      test_binding:
        exchange: test_exchange
        queue: test_queue
        routing_key: test_key
```

#### RocketMQé…ç½®

```yaml
rocketmq:
  dev:
    name_server: localhost:9876  # åç§°æœåŠ¡å™¨
    producer_group: test_producer_group    # ç”Ÿäº§è€…ç»„
    consumer_group: test_consumer_group    # æ¶ˆè´¹è€…ç»„
    producer:                    # ç”Ÿäº§è€…é…ç½®
      send_msg_timeout: 3000    # å‘é€è¶…æ—¶
      retry_times_when_send_failed: 2     # å‘é€å¤±è´¥é‡è¯•æ¬¡æ•°
      max_message_size: 4194304 # æœ€å¤§æ¶ˆæ¯å¤§å°
    consumer:                    # æ¶ˆè´¹è€…é…ç½®
      pull_batch_size: 32       # æ‹‰å–æ‰¹æ¬¡å¤§å°
      pull_interval: 0          # æ‹‰å–é—´éš”
      topics:                   # è®¢é˜…ä¸»é¢˜
        test_topic:
          name: test_topic
          tags: ["test_tag"]
          sub_expression: "*"
```

### æµ‹è¯•æ¶ˆæ¯å‘é€å’Œæ¶ˆè´¹

#### 1. å‘é€æµ‹è¯•æ¶ˆæ¯

```python
from common.mq_utils import MQManager
import json

# åˆ›å»ºæµ‹è¯•æ¶ˆæ¯
test_message = json.dumps({
    "id": 1,
    "content": "æµ‹è¯•æ¶ˆæ¯",
    "timestamp": time.time(),
    "type": "test"
})

# å‘é€åˆ°RabbitMQ
manager = MQManager()
success = manager.send_message('rabbitmq', test_message, 
                            exchange='test_exchange', routing_key='test_key')

# å‘é€åˆ°RocketMQ
success = manager.send_message('rocketmq', test_message, 
                            topic='test_topic', tags='test_tag')
```

#### 2. æ¶ˆè´¹æµ‹è¯•æ¶ˆæ¯

```python
# RabbitMQæ¶ˆè´¹
def rabbitmq_handler(ch, method, properties, body):
    try:
        message = json.loads(body.decode('utf-8'))
        print(f"æ”¶åˆ°RabbitMQæ¶ˆæ¯: {message}")
        # å¤„ç†æ¶ˆæ¯é€»è¾‘
        ch.basic_ack(delivery_tag=method.delivery_tag)
    except Exception as e:
        print(f"å¤„ç†æ¶ˆæ¯å¤±è´¥: {e}")
        ch.basic_nack(delivery_tag=method.delivery_tag)

# RocketMQæ¶ˆè´¹
def rocketmq_handler(msg):
    try:
        message = msg.body.decode('utf-8')
        print(f"æ”¶åˆ°RocketMQæ¶ˆæ¯: {message}")
        # å¤„ç†æ¶ˆæ¯é€»è¾‘
        return True  # æ¶ˆè´¹æˆåŠŸ
    except Exception as e:
        print(f"å¤„ç†æ¶ˆæ¯å¤±è´¥: {e}")
        return False  # æ¶ˆè´¹å¤±è´¥

# å¯åŠ¨æ¶ˆè´¹è€…
manager.consume_message('rabbitmq', rabbitmq_handler, queue='test_queue')
manager.consume_message('rocketmq', rocketmq_handler, topic='test_topic')
```

### ä¸»è¦ç‰¹æ€§

1. **å¤šMQæ”¯æŒ** - æ”¯æŒRabbitMQå’ŒRocketMQ
2. **é…ç½®é©±åŠ¨** - ä»é…ç½®æ–‡ä»¶åŠ è½½MQé…ç½®
3. **å¤šç¯å¢ƒæ”¯æŒ** - æ”¯æŒdevã€testã€prodç¯å¢ƒ
4. **ç»Ÿä¸€æ¥å£** - æä¾›ç»Ÿä¸€çš„æ¶ˆæ¯å‘é€å’Œæ¶ˆè´¹æ¥å£
5. **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
6. **è¿æ¥ç®¡ç†** - è‡ªåŠ¨ç®¡ç†è¿æ¥æ± å’Œè¿æ¥çŠ¶æ€
7. **æ¶ˆæ¯æŒä¹…åŒ–** - æ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–å’Œå¯é æ€§æŠ•é€’

### ä¾èµ–å®‰è£…

```bash
# å®‰è£…RabbitMQé©±åŠ¨
pip install pika

# å®‰è£…RocketMQé©±åŠ¨
pip install rocketmq-client-python
```

### æ³¨æ„äº‹é¡¹

1. **æœåŠ¡å¯ç”¨æ€§** - ç¡®ä¿RabbitMQæˆ–RocketMQæœåŠ¡æ­£åœ¨è¿è¡Œ
2. **ç½‘ç»œè¿æ¥** - ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œé˜²ç«å¢™å…è®¸ç›¸åº”ç«¯å£
3. **æƒé™é…ç½®** - ç¡®ä¿ç”¨æˆ·æœ‰ç›¸åº”çš„è¯»å†™æƒé™
4. **èµ„æºæ¸…ç†** - ä½¿ç”¨å®Œæ¯•ååŠæ—¶æ–­å¼€è¿æ¥
5. **é”™è¯¯å¤„ç†** - åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ 

---

## APIç›‘æ§åŠŸèƒ½

### æ¦‚è¿°

é¡¹ç›®æä¾›äº†å®Œæ•´çš„APIç›‘æ§åŠŸèƒ½ï¼Œè‡ªåŠ¨è®°å½•æ‰€æœ‰APIè¯·æ±‚å’Œå“åº”ä¿¡æ¯åˆ° `api_monitor.log` æ–‡ä»¶ã€‚è¯¥åŠŸèƒ½å¯ä»¥å¸®åŠ©å¼€å‘è€…ç›‘æ§APIæ€§èƒ½ã€è°ƒè¯•é—®é¢˜ã€åˆ†æè¯·æ±‚æ¨¡å¼ã€‚

### ä¸ºä»€ä¹ˆapi_monitor.logæ˜¯ç©ºçš„

ä¹‹å‰ `api_monitor.log` æ–‡ä»¶ä¸ºç©ºçš„åŸå› æ˜¯ï¼š

1. **æ—¥å¿—å‡½æ•°æœªè¢«è°ƒç”¨** - åªæœ‰ `api_info()` å’Œ `api_error()` å‡½æ•°æ‰ä¼šå†™å…¥ `api_monitor.log`
2. **æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨æ™®é€šæ—¥å¿—** - å½“å‰çš„æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨çš„æ˜¯ `info()` å’Œ `error()` å‡½æ•°ï¼Œè¿™äº›å†™å…¥åˆ° `log.log`
3. **ç¼ºå°‘è‡ªåŠ¨ç›‘æ§** - æ²¡æœ‰è‡ªåŠ¨ç›‘æ§æœºåˆ¶æ¥è®°å½•æ‰€æœ‰APIè¯·æ±‚

### è§£å†³æ–¹æ¡ˆ

ç°åœ¨é¡¹ç›®å·²ç»å®ç°äº†å®Œæ•´çš„APIç›‘æ§åŠŸèƒ½ï¼š

1. **HTTPå·¥å…·ç±»é›†æˆ** - æ‰€æœ‰HTTPè¯·æ±‚éƒ½ä¼šè‡ªåŠ¨è®°å½•åˆ° `api_monitor.log`
2. **APIç›‘æ§è£…é¥°å™¨** - æä¾›è£…é¥°å™¨æ¥è‡ªåŠ¨ç›‘æ§å‡½æ•°è°ƒç”¨
3. **ç›´æ¥æ—¥å¿—è®°å½•** - å¯ä»¥ç›´æ¥ä½¿ç”¨ `api_info()` å’Œ `api_error()` å‡½æ•°

### åŠŸèƒ½ç‰¹æ€§

1. **è‡ªåŠ¨ç›‘æ§** - æ‰€æœ‰HTTPè¯·æ±‚è‡ªåŠ¨è®°å½•
2. **è¯¦ç»†ä¿¡æ¯** - è®°å½•è¯·æ±‚URLã€æ–¹æ³•ã€å‚æ•°ã€å“åº”æ—¶é—´ã€çŠ¶æ€ç ç­‰
3. **é”™è¯¯è¿½è¸ª** - è®°å½•è¯·æ±‚å¤±è´¥çš„åŸå› å’Œé”™è¯¯ä¿¡æ¯
4. **æ€§èƒ½ç»Ÿè®¡** - æä¾›è¯·æ±‚ç»Ÿè®¡å’Œæ€§èƒ½åˆ†æ
5. **JSONæ ¼å¼** - æ—¥å¿—ä»¥JSONæ ¼å¼è®°å½•ï¼Œä¾¿äºè§£æå’Œåˆ†æ

### ä½¿ç”¨æ–¹æ³•

#### 1. è‡ªåŠ¨ç›‘æ§ï¼ˆæ¨èï¼‰

æ‰€æœ‰ä½¿ç”¨ `utils.http_utils` ä¸­çš„HTTPå‡½æ•°éƒ½ä¼šè‡ªåŠ¨è®°å½•åˆ° `api_monitor.log`ï¼š

```python
from utils.http_utils import http_get, http_post

# è¿™äº›è¯·æ±‚ä¼šè‡ªåŠ¨è®°å½•åˆ° api_monitor.log
response1 = http_get("https://api.example.com/users")
response2 = http_post("https://api.example.com/users", json_data={"name": "å¼ ä¸‰"})
```

#### 2. ä½¿ç”¨APIç›‘æ§è£…é¥°å™¨

```python
from common.api_monitor import api_monitor, http_monitor

# ç›‘æ§æ™®é€šå‡½æ•°
@api_monitor
def my_api_function():
    # å‡½æ•°é€»è¾‘
    return {"status": "success"}

# ç›‘æ§HTTPè¯·æ±‚
@http_monitor(url="https://api.example.com/test", method="GET")
def my_http_request():
    # HTTPè¯·æ±‚é€»è¾‘
    return {"status": "success"}
```

#### 3. ç›´æ¥è®°å½•APIæ—¥å¿—

```python
from common.log import api_info, api_error

# è®°å½•APIä¿¡æ¯
api_info("APIè¯·æ±‚å¼€å§‹: GET /api/users")
api_info("APIå“åº”æˆåŠŸ: 200 OK")

# è®°å½•APIé”™è¯¯
api_error("APIè¯·æ±‚å¤±è´¥: è¿æ¥è¶…æ—¶")
api_error("APIå“åº”é”™è¯¯: 500 Internal Server Error")
```

#### 4. ä½¿ç”¨APIç›‘æ§ç±»

```python
from common.api_monitor import APIMonitor

# åˆ›å»ºç›‘æ§å®ä¾‹
monitor = APIMonitor()

# è®°å½•è¯·æ±‚
monitor.record_request(
    url="https://api.example.com/users",
    method="GET",
    params={"id": 1},
    response={"status": "success"},
    execution_time=0.1
)

# è·å–ç»Ÿè®¡ä¿¡æ¯
stats = monitor.get_statistics()
print(f"è¯·æ±‚ç»Ÿè®¡: {stats}")
```

### æ—¥å¿—æ ¼å¼

#### HTTPè¯·æ±‚æ—¥å¿—

```json
{
  "timestamp": 1753890765.9612596,
  "method": "GET",
  "url": "https://jsonplaceholder.typicode.com/posts/1",
  "params": {},
  "json_data": {},
  "headers": {}
}
```

#### HTTPå“åº”æ—¥å¿—

```json
{
  "timestamp": 1753890769.8178039,
  "method": "GET",
  "url": "https://jsonplaceholder.typicode.com/posts/1",
  "status_code": 200,
  "execution_time_ms": 3856.54,
  "response_size": 292,
  "status": "success"
}
```

#### APIç›‘æ§è®°å½•

```json
{
  "timestamp": 1753890781.292537,
  "url": "https://api.example.com/test",
  "method": "GET",
  "params": {"id": 1},
  "status": "success",
  "execution_time_ms": 100.0,
  "request_count": 1,
  "success_count": 1,
  "error_count": 0,
  "avg_time_ms": 100.0,
  "response_size": 21
}
```

### ç›‘æ§å†…å®¹

#### è¯·æ±‚ä¿¡æ¯
- **URL** - è¯·æ±‚åœ°å€
- **æ–¹æ³•** - HTTPæ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETEç­‰ï¼‰
- **å‚æ•°** - æŸ¥è¯¢å‚æ•°å’Œè¯·æ±‚ä½“
- **è¯·æ±‚å¤´** - HTTPè¯·æ±‚å¤´ï¼ˆæ’é™¤æ•æ„Ÿä¿¡æ¯ï¼‰
- **æ—¶é—´æˆ³** - è¯·æ±‚å¼€å§‹æ—¶é—´

#### å“åº”ä¿¡æ¯
- **çŠ¶æ€ç ** - HTTPå“åº”çŠ¶æ€ç 
- **å“åº”å¤§å°** - å“åº”å†…å®¹å¤§å°
- **æ‰§è¡Œæ—¶é—´** - è¯·æ±‚æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- **å“åº”å†…å®¹** - å“åº”æ•°æ®ï¼ˆå¯é€‰ï¼‰

#### é”™è¯¯ä¿¡æ¯
- **é”™è¯¯ç±»å‹** - å¼‚å¸¸ç±»å‹
- **é”™è¯¯æ¶ˆæ¯** - è¯¦ç»†é”™è¯¯ä¿¡æ¯
- **é”™è¯¯å †æ ˆ** - é”™è¯¯å †æ ˆä¿¡æ¯ï¼ˆå¯é€‰ï¼‰

### æ€§èƒ½ç»Ÿè®¡

APIç›‘æ§ç±»æä¾›ä»¥ä¸‹ç»Ÿè®¡ä¿¡æ¯ï¼š

```python
{
  "total_requests": 10,           # æ€»è¯·æ±‚æ•°
  "success_requests": 8,          # æˆåŠŸè¯·æ±‚æ•°
  "error_requests": 2,            # å¤±è´¥è¯·æ±‚æ•°
  "success_rate": 80.0,           # æˆåŠŸç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
  "avg_execution_time_ms": 150.5, # å¹³å‡æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  "total_execution_time_ms": 1505.0 # æ€»æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
}
```

### æ—¥å¿—æ–‡ä»¶ç®¡ç†

- **æ–‡ä»¶ä½ç½®** - `log/api_monitor.log`
- **è½®è½¬ç­–ç•¥** - æ¯å¤©è½®è½¬ï¼Œä¿ç•™7å¤©
- **ç¼–ç æ ¼å¼** - UTF-8
- **æ—¥å¿—çº§åˆ«** - INFOå’ŒERROR

### é…ç½®è¯´æ˜

APIç›‘æ§åŠŸèƒ½é€šè¿‡ä»¥ä¸‹æ–¹å¼é…ç½®ï¼š

1. **æ—¥å¿—é…ç½®** - åœ¨ `common/log.py` ä¸­é…ç½®
2. **ç›‘æ§è£…é¥°å™¨** - åœ¨ `common/api_monitor.py` ä¸­å®šä¹‰
3. **HTTPå·¥å…·é›†æˆ** - åœ¨ `utils/http_utils.py` ä¸­é›†æˆ

### ä½¿ç”¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒ** - å»ºè®®å¯ç”¨APIç›‘æ§æ¥è¿½è¸ªæ€§èƒ½é—®é¢˜
2. **å¼€å‘ç¯å¢ƒ** - å¯ä»¥è¯¦ç»†è®°å½•æ‰€æœ‰APIè¯·æ±‚ç”¨äºè°ƒè¯•
3. **æµ‹è¯•ç¯å¢ƒ** - è®°å½•æµ‹è¯•è¿‡ç¨‹ä¸­çš„APIè°ƒç”¨ç”¨äºåˆ†æ
4. **æ—¥å¿—åˆ†æ** - å¯ä»¥ä½¿ç”¨å·¥å…·åˆ†æJSONæ ¼å¼çš„æ—¥å¿—æ–‡ä»¶ 